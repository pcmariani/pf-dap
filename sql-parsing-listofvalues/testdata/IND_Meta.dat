{
  "Records" : [
    {
      "SourceSqlQueryId" : 22,
      "TableDefinitionId" : 68,
      "SourceType" : "Db Query",
      "ResultTableType" : "Data Table",
      "Description" : "Data Tables for Justin IND Stability",
      "DisplayHeaders" : true,
      "Transpose" : true,
      "ParamUserInputMap" : [
        {
          "ParamName" : "C1.NAME",
          "UserInputId" : 130
        },
        {
          "ParamName" : "PC1.NAME",
          "UserInputId" : 130
        },
        {
          "ParamName" : "S1.LOT_NAME",
          "UserInputId" : 131
        },
        {
          "ParamName" : "T1.X_TEST_TYPE",
          "UserInputId" : 133
        },
        {
          "ParamName" : "S1.CONDITION",
          "UserInputId" : 134
        }
      ],
      "DbSystem" : "PharmSci Labware",
      "SqlStatement" : "SELECT \nPC1.NAME AS PARENT_COMPOUND_NAME,\nP1.DESCRIPTION as Product_DESC,\nP1.X_PRODUCT_TYPE as Product_Type,\nS1.LOT_NAME,\nS1.PROTOCOL,\nS1.PROTOCOL_LEVEL,\nS1.CONDITION,\nS1.TIMEPOINT,\nTP1.DISPLAY_STRING TP_STRING,\nROUND(DECODE(TP1.NUM_MONTHS,0,TP1.INTERVAL/86400/30.4167, tp1.num_months), 2) as Num_Months_Planned,\n\n \n\nT1.DESCRIPTION as Test_Description,\nT1.REPORTED_NAME as Test_Reported_Name,\n\n \n\nR1.NAME as R_NAME,\nR1.REPORTED_NAME AS R_REPORTED_NAME_ACTUAL,\nCOALESCE(PS1.REPORTED_NAME, R1.REPORTED_NAME) AS R_REPORTED_NAME_LATEST,\n\n \n\nR1.FORMATTED_ENTRY AS R_FORMATTED_ENTRY,\nU1.DISPLAY_STRING as UNITS_STRING,  \n\n \n\nPS1.DESCRIPTION as ACCEPTANCE_CRITERIA,\n\n'Results' as \"RESULTS_LABEL\",\n\n'Time (Months)' as \"TIMEPOINT_LABEL\"\n\n \n\nFROM \n    GLIMS_OWNER.X_COMPOUNDS C1\n\nLEFT OUTER JOIN \n    GLIMS_OWNER.X_COMPOUNDS PC1 ON C1.PARENT_COMPOUND_NAME = PC1.NAME\n\nINNER JOIN\n    GLIMS_OWNER.SAMPLE S1 \n    ON C1.COMPOUND_ID = S1.X_COMPOUND_ID\n    AND S1.SAMPLE_NUMBER = S1.ORIGINAL_SAMPLE\n    AND S1.STATUS IN ('A', 'C', 'P', 'U', 'I')\n    AND S1.GROUP_NAME <> 'TRAINING'\n    AND S1.PROTOCOL IS NOT NULL \n\nINNER JOIN\n    GLIMS_OWNER.SAMPLE S2 \n    ON S1.SAMPLE_NUMBER = S2.ORIGINAL_SAMPLE AND NOT(S2.SAMPLE_NUMBER <> S2.ORIGINAL_SAMPLE and S2.PARENT_ALIQUOT = 0)\n    AND S2.STATUS IN ('A', 'C', 'P', 'U', 'I')     \n\n \n\nINNER JOIN\n    GLIMS_OWNER.TEST T1 \n    ON S2.SAMPLE_NUMBER = T1.SAMPLE_NUMBER\n    AND T1.STATUS IN ('A', 'C', 'P')\n\nINNER JOIN\n    (select x.test_number, \n    MAX(DECODE(instr(x.name, 'Method No. '),1,x.formatted_entry)) as R_METHOD,\n    MAX(DECODE(x.name, 'Data Reference', x.formatted_entry)) as R_DATA_REF,\n    MAX(DECODE(x.name, 'Test Location', x.formatted_entry)) as R_TEST_LOC,\n    MAX(DECODE(x.name, 'Test Date', x.formatted_entry)) as R_TEST_DATE\n    from GLIMS_OWNER.result x\n    where x.status not in ('X', 'R', 'N')\n    and (x.Reported_name in ('Test Date', 'Test Location', 'Data Reference') OR instr(x.name, 'Method No') = 1)\n    group by x.test_number) RMETA\n    ON T1.TEST_NUMBER = RMETA.TEST_NUMBER\n\nINNER JOIN\n    GLIMS_OWNER.RESULT R1 \n    ON T1.TEST_NUMBER = R1.TEST_NUMBER  \n    and r1.name NOT in ('Test Date', 'Test Location', 'Data Reference', 'Method No. & Version/Effective Date', 'Method No. & Version/ Effective Date')\n    and r1.status not in ('X', 'R', 'N')\n\nLEFT OUTER JOIN\n    GLIMS_OWNER.UNITS U1\n    ON R1.UNITS = U1.UNIT_CODE\n\n \n\nINNER JOIN \n    GLIMS_OWNER.PRODUCT_SPEC PS1 \n    ON S1.PRODUCT = PS1.PRODUCT\n\n \n\n    AND PS1.VERSION = (SELECT MAX(X1.VERSION) FROM GLIMS_OWNER.PRODUCT X1 WHERE S1.PRODUCT = X1.NAME AND X1.ACTIVE = 'T')\n\n \n\n    AND S1.PRODUCT_GRADE = PS1.GRADE \n    AND S1.SAMPLING_POINT = PS1.SAMPLING_POINT     \n    AND S1.SPEC_TYPE = PS1.SPEC_TYPE \n    AND S1.STAGE = PS1.STAGE\n    AND T1.ANALYSIS = PS1.ANALYSIS \n    AND R1.NAME = PS1.COMPONENT\n    AND PS1.RULE_TYPE<> 'F'\n    AND PS1.X_EXTERNAL_REPORT = 'T'\n\nINNER JOIN GLIMS_OWNER.PRODUCT P1\n    ON S1.PRODUCT = P1.NAME \n    AND S1.PRODUCT_VERSION = P1.VERSION\n\n \n\nLEFT OUTER JOIN \n    GLIMS_OWNER.LOT L1 \n    ON S1.LOT_NAME = L1.LOT_NAME\n\n\nLEFT OUTER JOIN\n    GLIMS_OWNER.TIMEPOINT TP1\n    ON S1.TIMEPOINT = TP1.NAME\n\n \n\nWHERE\n\n \n\n(C1.NAME = ? OR PC1.NAME = ?)\nAND S1.LOT_NAME = ?\nAND T1.X_TEST_TYPE = ?\nAND S1.CONDITION = ?\n\nORDER BY S1.PRODUCT, S1.LOT_NAME, S2.SAMPLE_NUMBER, T1.ANALYSIS, T1.TEST_NUMBER, R1.order_number",
      "IsPivot" : true,
      "PivotOnColumns" : [
        {
          "Column" : "Test_Description",
          "Label" : "Assay Name",
          "IsKeyColumn" : true
        },
        {
          "Column" : "R_REPORTED_NAME_LATEST",
          "Label" : "Parameter Name",
          "IsKeyColumn" : true
        },
        {
          "Column" : "ACCEPTANCE_CRITERIA",
          "Label" : "Clinical Acceptance Criteria",
          "IsKeyColumn" : false
        }
      ],
      "PivotGroupByColumns" : [
        {
          "Column" : "TIMEPOINT_LABEL"
        },
        {
          "Column" : "Num_Months_Planned"
        }
      ],
      "PivotDataColumn" : "R_FORMATTED_ENTRY",
      "PivotTopLeftCornerOpt" : "Pivot On Label"
    }
  ]
}
